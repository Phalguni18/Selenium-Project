package com.Framework;

import java.io.File;
import java.io.FileNotFoundException;
import java.io.FileOutputStream;
import java.io.IOException;
import java.util.List;
import java.util.concurrent.TimeUnit;

import org.apache.poi.ss.usermodel.Cell;
import org.apache.poi.ss.usermodel.Row;
import org.apache.poi.ss.usermodel.Workbook;
import org.apache.poi.xssf.usermodel.XSSFSheet;
import org.apache.poi.xssf.usermodel.XSSFWorkbook;
import org.openqa.selenium.By;
import org.openqa.selenium.JavascriptExecutor;
import org.openqa.selenium.WebDriver;
import org.openqa.selenium.WebElement;
import org.openqa.selenium.chrome.ChromeDriver;
import org.testng.ITestResult;
import org.testng.annotations.AfterMethod;
import org.testng.annotations.BeforeTest;
import org.testng.annotations.Test;
import com.relevantcodes.extentreports.ExtentReports;
import com.relevantcodes.extentreports.ExtentTest;
import com.relevantcodes.extentreports.LogStatus;
import com.relevantcodes.extentreports.ExtentReports;

public class makemytrip 
{
	@BeforeTest
	public void startReport()
	{
		 ExtentReports extent = new ExtentReports (System.getProperty("user.dir") +"/test-output/STMExtentReport.html", true);
		 extent.loadConfig(new File(System.getProperty("user.dir")+"\\extent-config.xml"));
	}
	WebDriver driver;
    @Test
    public void trip() throws InterruptedException
    {
        System.setProperty("webdriver.chrome.driver","C:\\chromedriver_win32\\chromedriver.exe");
        driver = new ChromeDriver();
      // Launch the application	makemytrip	
        driver.get("https://www.makemytrip.com/");
        driver.manage().window().maximize();
        Thread.sleep(10);
        String actualTitle=" ";
        actualTitle=driver.getTitle();
        String url=driver.getCurrentUrl();
        System.out.println(url);
        String expectedTitle=actualTitle;
        if(actualTitle.contentEquals(expectedTitle))
        {
            System.out.println("Test pass");
        }
        else
        {
            System.out.println("Test fail");
        }

        System.out.println("Select one way option");
        driver.manage().timeouts().implicitlyWait(10, TimeUnit.SECONDS);
        
   //Select From , To and Date and sendkeys.  
        driver.findElement(By.xpath("//input[@placeholder='From']")).click();
        driver.findElement(By.xpath("//input[@placeholder='From']")).sendKeys("Hyderabad");
        driver.findElement(By.xpath("//input[@placeholder='To']")).click();
        driver.findElement(By.xpath("//input[@placeholder='From']")).sendKeys("Mumbai");
        driver.findElement(By.xpath("//span[contains(text(),'DEPARTURE')]")).click();
        driver.findElement(By.xpath("//span[@class='DayPicker-NavButton DayPicker-NavButton--next']")).click();
        driver.findElement(By.xpath("//div[@class='DayPicker-Day DayPicker-Day--selected']//p[contains(text(),'25')]")).click();
   
   //Click on Search button 
        driver.findElement(By.xpath("//a[contains(@class,'primaryBtn font24 latoBold widgetSearchBtn')]")).click();
        
  // a.	To find the total number of flights showing in search results      
        
        List<WebElement> flights = driver.findElements(By.xpath("//div[@id='fli_list_item_7afcb573-28fe-4e9c-94a0-13df4e226d30']//div"));
        System.out.println("total no of value"+flights.size());
        for (WebElement product : flights)
        {
            System.out.println(product.getText());
        }
    }
 /*  b.	To import the below search results in excel file
       	Flight No, Flight Name, Flight Time, Departure time, Arrival time, Price.*/
        
        public void writetoexcel() throws IOException
        {
        
        File file = new File("C:\\makemytrip\\FlightDetails.xlxs");
        XSSFWorkbook wb = new XSSFWorkbook();
        XSSFSheet sh = wb.createSheet();
        sh.createRow(0).createCell(0).setCellValue("Flight No");
        sh.createRow(0).createCell(1).setCellValue("Flight Name");
        sh.createRow(0).createCell(2).setCellValue("Flight Time");
        sh.createRow(0).createCell(3).setCellValue("Departure time");
        sh.createRow(0).createCell(4).setCellValue("Arrival time");
        sh.createRow(0).createCell(5).setCellValue("Price");
        
        FileOutputStream fos = new FileOutputStream(file);
        wb.write(fos);
       
        } 
    // c.	Must have extent report for test results
       	 
            @AfterMethod
            
            public void getResult(ITestResult result) throws IOException
            {
        	      ExtentTest extenttest = null;
				        if(result.getStatus() == ITestResult.FAILURE)
                {
                	extenttest.log(LogStatus.FAIL, " Test case FAILED due to below issues:"+result.getName());
                  extenttest.log(LogStatus.FAIL, result.getThrowable());
     
                }
                else if(result.getStatus() == ITestResult.SUCCESS)
                {
                	extenttest.log(LogStatus.PASS," Test Case PASSED"+ result.getName());
                }
                else if(result.getStatus() == ITestResult.SKIP)
                {
                	extenttest.log(LogStatus.SKIP," Test Case SKIPPED" + result.getName());
                	extenttest.log(LogStatus.SKIP, result.getThrowable());
                }
                ExtentReports extent = null;
				        extent.flush();
                
            }
        
   
}
